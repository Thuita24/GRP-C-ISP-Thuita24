{% extends "base.html" %}

{% block title %}Dashboard - Cotton Prediction{% endblock %}

{% block extra_css %}
<style>
    .prediction-card {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
    }
    .stats-card {
        transition: transform 0.2s;
    }
    .stats-card:hover {
        transform: translateY(-2px);
    }
    .feature-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2>Welcome back, {{ user.name if user else 'User' }}!</h2>
        <p class="text-muted">Cotton Prediction Dashboard</p>
    </div>
</div>

<!-- Quick Stats -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body text-center">
                <h3 class="text-success">{{ total_predictions or 0 }}</h3>
                <p class="mb-0">Total Predictions</p>
            </div>
        </div>
    </div>

  <div class="col-md-3">
    <div class="card stats-card">
        <div class="card-body text-center">
            <h3 class="text-info">{{ avg_yield or 0 }}</h3>  
            <p class="mb-0">Avg Yield (bales/ha)</p>
        </div>
    </div>
</div>

    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body text-center">
                <h3 class="text-warning">{{ farms_count or 1 }}</h3>
                <p class="mb-0">Farm Locations</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body text-center">
                <h3 class="text-danger">62%</h3>
                <p class="mb-0">Model Accuracy (R¬≤)</p>
            </div>
        </div>
    </div>
</div>

<!-- AI-Powered Prediction Features (3 CARDS) -->
<div class="row mb-4">
    <div class="col-12">
        <h4 class="mb-3">üåæ AI-Powered Predictions</h4>
    </div>
    
    <!-- Card 1: Geographic Yield Prediction (Main Feature) -->
    <div class="col-md-4 mb-3">
        <div class="card feature-card shadow-sm h-100" style="border: 3px solid #28a745;">
            <div class="card-body text-center">
                <div class="mb-3">
                    <span style="font-size: 3rem;">üåç</span>
                </div>
                <h5 class="card-title">
                    Cotton Yield Prediction 
                    <span class="badge bg-success">Kenya  üá∞üá™</span>
                </h5>
                <p class="card-text text-muted">
                    AI-powered yield prediction using geographic characteristics. 
                   
                </p>
                <a href="{{ url_for('geographic.predict_form') }}" class="btn btn-success btn-lg w-100">
                    üéØ Predict Yield
                </a>
                <small class="d-block mt-2 text-success fw-bold">
                    Recommended for Kenya users!
                </small>
            </div>
        </div>
    </div>

    <!-- Card 2: Optimal Planting Time -->
    <div class="col-md-4 mb-3">
        <div class="card feature-card shadow-sm h-100" style="border: 2px solid #17a2b8;">
            <div class="card-body text-center">
                <div class="mb-3">
                    <span style="font-size: 3rem;">üìÖ</span>
                </div>
                <h5 class="card-title">
                    Optimal Planting Time
                    <span class="badge bg-info"></span>
                </h5>
                <p class="card-text text-muted">
                    Find the best month to plant cotton based on your location's 
                    rainfall patterns and climate conditions.
                </p>
                <a href="{{ url_for('geographic.optimal_planting_form') }}" class="btn btn-info btn-lg w-100">
                    Find Best Time
                </a>
            </div>
        </div>
    </div>

    <!-- Card 3: Prediction History -->
    <div class="col-md-4 mb-3">
        <div class="card feature-card shadow-sm h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <span style="font-size: 3rem;">üìú</span>
                </div>
                <h5 class="card-title">Prediction History</h5>
                <p class="card-text text-muted">
                    View your past yield predictions and planting time recommendations 
                    with detailed analytics.
                </p>
                <a href="{{ url_for('geographic.history') }}" class="btn btn-primary btn-lg w-100">
                     View History
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Prediction Result Display (if any) -->
{% if prediction_result %}
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-success alert-dismissible fade show">
            <h5> Prediction Complete!</h5>
            <p class="mb-0">
                Predicted Cotton Yield: <strong>{{ prediction_result.yield }}%</strong>
                <br>
                Expected Production: <strong>{{ prediction_result.production }} kg</strong> 
                from {{ prediction_result.area }} hectares
            </p>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    </div>
</div>
{% endif %}

<!-- Recent Predictions Section -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>üìä Recent Predictions</h5>
            </div>
            <div class="card-body">
                {% if recent_predictions and recent_predictions|length > 0 %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Location</th>
                                    <th>Predicted Yield</th>
                                    <th>Rainfall Zone</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for prediction in recent_predictions %}
                                <tr>
                                    <td>{{ prediction['date'][:10] if prediction['date'] else 'N/A' }}</td>
                                    <td>
                                        {% if prediction['location'] and prediction['location'] != 'Unknown' and prediction['location'] != 'Unknown Location' %}
                                            <strong>{{ prediction['location'] }}</strong>
                                        {% else %}
                                            <span class="text-muted">Unknown</span>
                                        {% endif %}
                                    </td>
                                    <td><strong class="text-success">{{ prediction['predicted_yield'] }} bales/ha</strong></td>
                                    <td>
                                        {% if prediction['rainfall_zone'] == 'Arid' %}
                                            <span class="badge bg-danger">üèúÔ∏è Arid</span>
                                        {% elif prediction['rainfall_zone'] == 'Semi-arid' %}
                                            <span class="badge bg-warning text-dark">üåæ Semi-arid</span>
                                        {% elif prediction['rainfall_zone'] == 'Sub-humid' %}
                                            <span class="badge bg-info">üå± Sub-humid</span>
                                        {% elif prediction['rainfall_zone'] == 'Humid' %}
                                            <span class="badge bg-success">üå≥ Humid</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ prediction['rainfall_zone'] }}</span>
                                        {% endif %}
                                    </td>
                                    <td><span class="badge bg-success">Complete</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <span style="font-size: 3rem;">üåæ</span>
                        <h5 class="mt-3">No predictions yet</h5>
                        <p class="text-muted mb-3">Start by making your first cotton yield prediction!</p>
                        <a href="{{ url_for('geographic.predict_form') }}" class="btn btn-success btn-lg">
                            üéØ Make First Prediction
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}